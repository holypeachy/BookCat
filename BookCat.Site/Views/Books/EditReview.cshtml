@using BookCat.Site.Controllers
@model BooksController.EditReviewViewModel

@{
    ViewData["Title"] = Model.Book.Title;
}

<div class="book-wrapper">
    <div class="book-img-wrapper">
        @if (Model.Book.CoverUrl is null)
        {
            <img class="cover-img" src="~/images/default_book.png" atl="Cover for @Model.Book.Title">
        }
        else
        { 
            <img class="cover-img" src="@Model.Book.CoverUrl" atl="Cover for @Model.Book.Title">
        }
    </div>
    <div class="book-info-wrapper">
        <h3 class="title">@Model.Book.Title</h3>
        @if(Model.Book.Subtitle is not null){
            <h4 class="subtitle">@Model.Book.Subtitle</h4>
        }
        @if(Model.Book.Author is not null){
            <p>Author: @Model.Book.Author</p>
        }
        @if(Model.Book.Publisher is not null){
            <p>Publisher: @Model.Book.Publisher</p>
        }
        @if(Model.Book.PublishedDate is not null){
            <p>Published: @Model.Book.PublishedDate</p>
        }
        @if(Model.Book.AddedById is not null && Model.Book.AddedBy is not null){
            <p>Added By: <a asp-controller="User" asp-action="Index" asp-route-id="@Model.Book.AddedById">@Model.Book.AddedBy.UserName</a></p>
        }
        <p>Date Added: @(DateOnly.FromDateTime(Model.Book.AddedOn))</p>
    </div>
</div>
<div class="book-description">
    <h3>Description</h3>
    <p>@Html.Raw(Model.Book.Description)</p>
</div>
<div id="WriteReview">
    <h3>Edit Review</h3>
</div>
<form class="add-review-form" asp-action="EditReview" method="post">
    <input asp-for="ReviewId" class="hidden" type="text" value="@Model.ReviewId" required>
    <div class="star-container">
        <div class="rating-text">Change your rating</div>
        @for(int i = 1; i <= Model.Rating; i++){
            <span id="star-@i" class="material-symbols-outlined active-star" onclick="rating(@i)">star_rate</span>
        }
        @for(int i = Model.Rating + 1; i <= 5; i++){
            <span id="star-@i" class="material-symbols-outlined inactive-star" onclick="rating(@i)">star_rate</span>
        }
        <input asp-for="Rating" id="hidden-input" class="hidden" type="number" value="@Model.Rating"/>
    </div>
    <span asp-validation-for="Title" class="text-danger"></span>
    <input class="form-title input-border" type="text" asp-for="Title" placeholder="Title" required>
    <span asp-validation-for="Comment" class="text-danger"></span>
    <textarea class="form-comment input-border" asp-for="Comment" placeholder="Your Review" required></textarea>
    <input class="btn form-btn" type="submit" value="Update">
</form>
<form class="delete-review" asp-controller="Books" asp-action="DeleteReview" method="post" onsubmit="return confirm('Are you sure you want to delete this review?');">
    <input class="hidden" type="text" value="@Model.ReviewId" name="id">
    <input class="hidden" type="text" value="/Books/Details/@Model.Book.Id" name="returnUrl">
    <input class="btn-danger delete-btn" type="submit" value="Delete">
</form>
<div class="spacing">
</div>

@section Styles{
    <link rel="stylesheet" href="~/css/details.css">
    <link rel="stylesheet" href="~/css/add-review.css">
    <link rel="stylesheet" href="~/css/edit-review.css">
}
@section Scripts{
    <script src="~/js/stars.js"></script>
    <partial name="_ValidationScriptsPartial"/>
}